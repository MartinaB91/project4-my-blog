<h3>Comments</h3>
{% if not post.post_comments.all %}
<p>This post has no comments</p>
<!-- Todo: Add link to comment form  -->
{% else %}
{% for comment in post.post_comments.all %}
<div>
    <p><strong>{{comment.author}}</strong> | {{comment.created_on}} </p>
    <p>{{comment.content}}</p>
</div>
{% endfor %}
{% endif %}

<form id="comment-form" class="comment-form" name="{% url 'create_comment' post.slug %}">
    <div class="row">
        <textarea class="form-control" placeholder="Leave your comment here..." id="content" name="content"></textarea>
        <div class="text-center">
            <button class="btn btn-outline-secondary btn-comment">Leave Comment</button>
        </div>
    </div>

</form>

{# Handling comments without page refresh #}
{% block scripts %}
<script>
    // Inspiration from: 
    // https://dev.to/thepylot/how-to-send-django-form-with-ajax-4bpo
    $(document).on('submit', '.comment-form', function (e) {
        // Prevent execution of click for every button in class
        e.stopPropagation();
        e.stopImmediatePropagation();
        let textBoxContent = $(this).children().first().children().first(); // Get comment texarea 

        $.ajax({
            method: 'POST',
            url: $(this).attr('name'),
            data: {
                'content': textBoxContent.val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            success: function (response) {
                textBoxContent.val('');
                textBoxContent.attr("placeholder", "Thank you! Your comment will soon be reviewed.");
            }
        });
        return false;
    });
</script>
{% endblock scripts %}